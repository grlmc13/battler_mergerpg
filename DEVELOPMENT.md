# üõ†Ô∏è –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç—è—Ç –ø–æ–Ω—è—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏–≥—Ä—ã.

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

```
GameScene (–≥–ª–∞–≤–Ω–∞—è —Å—Ü–µ–Ω–∞)
‚îú‚îÄ‚îÄ GridSystem (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–∫–æ–π)
‚îú‚îÄ‚îÄ BattleSystem (–ª–æ–≥–∏–∫–∞ –±–æ—è)
‚îî‚îÄ‚îÄ EconomySystem (—ç–∫–æ–Ω–æ–º–∏–∫–∞)
```

### –ö–ª–∞—Å—Å—ã —é–Ω–∏—Ç–æ–≤

```
Unit (–±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å)
‚îú‚îÄ‚îÄ Archer (–ª—É—á–Ω–∏–∫)
‚îú‚îÄ‚îÄ Warrior (–º–µ—á–Ω–∏–∫)  
‚îú‚îÄ‚îÄ Barbarian (–≤–∞—Ä–≤–∞—Ä)
‚îú‚îÄ‚îÄ Healer (–ª–µ–∫–∞—Ä—å —Å –ª–µ—á–µ–Ω–∏–µ–º)
‚îî‚îÄ‚îÄ Mage (–º–∞–≥ —Å –º—É–ª—å—Ç–∏-—Ç–∞—Ä–≥–µ—Ç–æ–º)
```

## üéÆ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–∞—É–Ω–¥–∞

```mermaid
graph TD
    A[–ù–∞—á–∞–ª–æ —Ä–∞—É–Ω–¥–∞] --> B[–í—ã–¥–∞—á–∞ –º–æ–Ω–µ—Ç]
    B --> C[–í–æ—Å–∫—Ä–µ—à–µ–Ω–∏–µ —é–Ω–∏—Ç–æ–≤]
    C --> D[–ü–æ–ª–Ω–æ–µ –ª–µ—á–µ–Ω–∏–µ]
    D --> E[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞]
    E --> F[–†–∞–∑–º–µ—â–µ–Ω–∏–µ —é–Ω–∏—Ç–æ–≤]
    F --> G[–ù–∞–∂–∞—Ç–∏–µ FIGHT]
    G --> H[–ë–æ–π]
    H --> I{–ü–æ–±–µ–¥–∞/–ü–æ—Ä–∞–∂–µ–Ω–∏–µ}
    I --> J[–ü–æ–¥—Å—á–µ—Ç —É–±–∏–π—Å—Ç–≤]
    J --> K{–ú–∞—Ç—á –æ–∫–æ–Ω—á–µ–Ω?}
    K -->|–î–∞| L[–≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    K -->|–ù–µ—Ç| A
```

## üí∞ –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞

### –§–æ—Ä–º—É–ª–∞ –¥–æ—Ö–æ–¥–∞
```javascript
income = BASE_REWARD + KILLS_LAST_ROUND
// BASE_REWARD = 5 –º–æ–Ω–µ—Ç
// KILLS_LAST_ROUND = –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–±–∏—Ç—ã—Ö –≤—Ä–∞–≥–æ–≤ –≤ –ø—Ä–æ—à–ª–æ–º —Ä–∞—É–Ω–¥–µ
```

### –ü—Ä–∏–º–µ—Ä
- –†–∞—É–Ω–¥ 1: —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª = 10 –º–æ–Ω–µ—Ç
- –£–±–∏—Ç–æ 4 –≤—Ä–∞–≥–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ `enemiesKilledLastRound`
- –†–∞—É–Ω–¥ 2: –¥–æ—Ö–æ–¥ = 5 + 4 = 9 –º–æ–Ω–µ—Ç

## üéØ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —é–Ω–∏—Ç–∞

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –≤ gameConfig

```javascript
UNIT_TYPES: {
    NEW_UNIT: {
        name: '–ù–æ–≤—ã–π —é–Ω–∏—Ç',
        size: { width: 1, height: 1 },
        cost: 3,
        hp: 40,
        damage: 10,
        attackSpeed: 1.0,
        range: 10,
        color: 0xFF00FF
    }
}
```

### –®–∞–≥ 2: –°–æ–∑–¥–∞—Ç—å –∫–ª–∞—Å—Å —é–Ω–∏—Ç–∞

```javascript
class NewUnit extends Unit {
    constructor(scene, gridX, gridY, isEnemy = false) {
        super(scene, gridX, gridY, isEnemy, 
              { width: 1, height: 1 }, 
              0xFF00FF);
        
        this.maxHp = 40;
        this.hp = this.maxHp;
        this.damage = 10;
        this.attackSpeed = 1.0;
        this.range = 10;
        
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–∏—Ç—å —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
        // this.hasTaunt = true; // –ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è (–∫–∞–∫ —É –í–∞—Ä–≤–∞—Ä–∞)
        
        this.updateVisuals();
    }

    updateVisuals() {
        if (this.sprite) {
            this.sprite.setFillStyle(this.color);
            if (this.isEnemy) {
                this.sprite.setFillStyle(0x666666);
            }
        }
    }
    
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å attack() –¥–ª—è –æ—Å–æ–±—ã—Ö –º–µ—Ö–∞–Ω–∏–∫
    // –ü—Ä–∏–º–µ—Ä: –í–∞—Ä–≤–∞—Ä —Å –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–µ–π, –ú–∞–≥ —Å –º—É–ª—å—Ç–∏-—Ç–∞—Ä–≥–µ—Ç–æ–º, –õ–µ–∫–∞—Ä—å —Å –ª–µ—á–µ–Ω–∏–µ–º
}
```

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –≤ placeUnit()

```javascript
case 'NEW_UNIT':
    unit = new NewUnit(this, gridX, gridY);
    break;
```

### –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å –≤ spawnEnemies()

```javascript
const unitTypes = [
    { type: 'ARCHER', data: UNIT_TYPES.ARCHER },
    { type: 'NEW_UNIT', data: UNIT_TYPES.NEW_UNIT }, // –î–æ–±–∞–≤–∏—Ç—å
    // ...
];

// –ò –≤ switch
case 'NEW_UNIT':
    enemy = new NewUnit(this, x, y, true);
    break;
```

### –®–∞–≥ 5: –î–æ–±–∞–≤–∏—Ç—å –∏–∫–æ–Ω–∫—É –≤ –º–∞–≥–∞–∑–∏–Ω–µ

```javascript
createShopCards(shopY) {
    // ...
    if (type === 'NEW_UNIT') {
        this.add.circle(x, shopY - 20, 12, 0xFF00FF);
        // –ò–ª–∏ –¥—Ä—É–≥–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
    }
}
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã

### GridSystem

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `createGrid()` | –°–æ–∑–¥–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—É—é —Å–µ—Ç–∫—É |
| `canPlaceUnit()` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —é–Ω–∏—Ç–∞ |
| `placeUnit()` | –†–∞–∑–º–µ—â–∞–µ—Ç —é–Ω–∏—Ç–∞ –Ω–∞ —Å–µ—Ç–∫–µ |
| `getGridPosition()` | –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ —Å–µ—Ç–∫—É |
| `getWorldPosition()` | –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç —Å–µ—Ç–∫—É –≤ –º–∏—Ä–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã |

### BattleSystem

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `startBattle()` | –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ–π |
| `updateBattle()` | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 100–º—Å |
| `processAttacks()` | –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞—Ç–∞–∫–∏ —é–Ω–∏—Ç–æ–≤ |
| `findNearestTarget()` | –ò—â–µ—Ç –±–ª–∏–∂–∞–π—à—É—é —Ü–µ–ª—å |
| `endBattle()` | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –±–æ–π |

### GameScene

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `init()` | –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ |
| `create()` | –°–æ–∑–¥–∞–µ—Ç –∏–≥—Ä–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã |
| `selectUnit()` | –í—ã–±–∏—Ä–∞–µ—Ç —é–Ω–∏—Ç–∞ –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞ |
| `placeUnit()` | –†–∞–∑–º–µ—â–∞–µ—Ç —é–Ω–∏—Ç–∞ –Ω–∞ –ø–æ–ª–µ |
| `startBattle()` | –ù–∞—á–∏–Ω–∞–µ—Ç –±–æ–π |
| `endBattle()` | –ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞—É–Ω–¥ |
| `prepareNextRound()` | –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É |
| `resurrectUnits()` | –í–æ—Å–∫—Ä–µ—à–∞–µ—Ç –∏ –ª–µ—á–∏—Ç —é–Ω–∏—Ç–æ–≤ |
| `checkMatchEnd()` | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–∫–æ–Ω—á–∞–Ω–∏–µ –º–∞—Ç—á–∞ (Bo5) |
| `endGame()` | –ó–∞–≤–µ—Ä—à–∞–µ—Ç –º–∞—Ç—á |

## üé® –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –†–∞–∑–º–µ—Ä—ã —Å–µ—Ç–∫–∏
- `GRID_WIDTH: 8` - —à–∏—Ä–∏–Ω–∞ –ø–æ–ª—è
- `GRID_HEIGHT: 6` - –≤—ã—Å–æ—Ç–∞ –ø–æ–ª—è
- `CELL_SIZE: 50` - —Ä–∞–∑–º–µ—Ä –∫–ª–µ—Ç–∫–∏ –≤ –ø–∏–∫—Å–µ–ª—è—Ö
- `PLAYER_AREA_HEIGHT: 3` - —Ä—è–¥–æ–≤ –¥–ª—è –∏–≥—Ä–æ–∫–∞
- `ENEMY_AREA_HEIGHT: 3` - —Ä—è–¥–æ–≤ –¥–ª—è –≤—Ä–∞–≥–∞

### –ü—Ä–∞–≤–∏–ª–∞ –º–∞—Ç—á–∞
- `maxRounds: 5` - –º–∞–∫—Å–∏–º—É–º —Ä–∞—É–Ω–¥–æ–≤
- `winsNeeded: 3` - –ø–æ–±–µ–¥ –¥–ª—è –ø–æ–±–µ–¥—ã

### –≠–∫–æ–Ω–æ–º–∏–∫–∞
- `STARTING_COINS: 10` - —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª
- `baseReward: 5` - –º–æ–Ω–µ—Ç –∑–∞ –Ω–æ–≤—ã–π —Ä–∞—É–Ω–¥
// –£—Ç–æ—á–Ω–µ–Ω–∏–µ: –±–æ–Ω—É—Å—ã –∑–∞ —É–±–∏–π—Å—Ç–≤–∞ –º–æ–≥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü–æ–ª–µ–∑–Ω—ã–µ –ª–æ–≥–∏

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
console.log('=== –ù–ê–ß–ê–õ–û –ë–û–Ø ===');
console.log('–Æ–Ω–∏—Ç–æ–≤ –∏–≥—Ä–æ–∫–∞:', this.playerUnits.length);
console.log('–°—á–µ—Ç –º–∞—Ç—á–∞:', playerWins, '-', enemyWins);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```javascript
// –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥
console.log(this.currentRound);

// –ò—Å—Ç–æ—Ä–∏—è —Ä–∞—É–Ω–¥–æ–≤
console.log(this.roundResults); // [true, false, true] = –í-–ü-–í

// –ú–æ–Ω–µ—Ç—ã
console.log(this.economySystem.getCoins());
```

## üì± –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```javascript
const config = {
    width: 480,
    height: 900,
    scale: {
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH
    }
};
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫—Ä—É–ø–Ω—ã–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ –æ–±–ª–∞—Å—Ç–∏ (–º–∏–Ω–∏–º—É–º 44x44px)
- –ò–∑–±–µ–≥–∞–π—Ç–µ hover —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
- –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pointer` —Å–æ–±—ã—Ç–∏—è –≤–º–µ—Å—Ç–æ `mouse`

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **Avoid –≤ update()**
   - –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ update() –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —é–Ω–∏—Ç–æ–≤
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±—ã—Ç–∏—è: `once('pointerdown')`

2. **Tweens cleanup**
   - –í—Å–µ–≥–¥–∞ —É–Ω–∏—á—Ç–æ–∂–∞–π—Ç–µ graphics –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `killTweensOf()` –ø–µ—Ä–µ–¥ –Ω–æ–≤–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π

3. **Object pooling**
   - –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
   - –û—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —á–∞—Å—Ç–∏—Ü –∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

## üìù –°—Ç–∏–ª—å –∫–æ–¥–∞

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ
- –ö–ª–∞—Å—Å—ã: `PascalCase`
- –ú–µ—Ç–æ–¥—ã: `camelCase`
- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã: `UPPER_SNAKE_CASE`
- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è: `_camelCase` (—É—Å–ª–æ–≤–Ω–æ)

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
```javascript
// –û–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π

/**
 * –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
 * –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ –∏ –≤–∞–∂–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
 */
```

## üîÆ –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –º–æ–¥—É–ª–∏**
   - –†–∞–∑–±–∏—Ç—å game.js –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ES6 modules

2. **TypeScript**
   - –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

3. **Unit tests**
   - –¢–µ—Å—Ç—ã –¥–ª—è GridSystem
   - –¢–µ—Å—Ç—ã –¥–ª—è BattleSystem

4. **State management**
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

5. **Asset loader**
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–ø—Ä–∞–π—Ç–æ–≤
   - –ó–≤—É–∫–∏ –∏ –º—É–∑—ã–∫–∞

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Phaser 3 Documentation](https://photonstorm.github.io/phaser3-docs/)
- [Phaser 3 Examples](https://phaser.io/examples)
- [Auto-battler Genre Guide](https://en.wikipedia.org/wiki/Auto_battler)

---

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –∏–∑—É—á–∏—Ç–µ –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ Issue –Ω–∞ GitHub.

